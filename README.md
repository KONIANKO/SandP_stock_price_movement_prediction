
# S&P 500 stock price predictor with an accuracy of 0.667 (66.7%)


# Instructions to run the code in jupyter notebook

0. go to project folder in a cmd tool
1. virtualenv venv (create virtual environment)
2. .\venv\Scripts\activate (activate virtual environment)
3. python -m ipykernel install --name=venv (return: Installed kernelspec venv in C:\ProgramData\jupyter\kernels\venv) (link jupyter notebook to your virtual environment)
4. pip install -r requirements.txt
5. jupter notebook (start jupyter notebook)


# Задача

1. Подтвердить или опровергнуть результаты исследования, описанные в работе Forecasting the Stock Market using News Sentiment Analysis , по двум прогнозам, полученным с использованием:

	1. SVM, TextBlob. 
	2. SVM, TextBlob+TA. По каждому отобразить accuracy и confusion matrix. 
	
2. Предоставить Ваше экспертное мнение об исходном исследовании, его предмете и результатах. 


# Требования: 

1. Представить в github в виде полностью рабочего кода jupyter notebook с комментариями кода, его результатов, и, в случае отличия от исходного исследования, предполагаемых причин отличия (например, выбрали записи по параметру X, у нас получилось ...., а работе .... расхождение возможно по причине...) 

2. Презентовать полученные данные на онлайн сессии (время и дата согласовывается после сдачи).


# Источники

1. Forecasting the Stock Market using News Sentiment Analysis. Прилагается.
2. Dataset YahooFinancials package. Прилагается.
3. Dataset “all-the-news-2-1”. Скачать здесь - https://components.one/datasets/all-the-news-2-news-articles-dataset/.


# Мнение об исходном исследовании, его предмете и результатах. 

* Центральныйм вопросом исследования было узнать, можно ли использовать сентимент новостей для предсказания движения рынка. Как и автор статьи, я могу подтвердить, что сентимент новостей можно использовать для предсказания рынка. Также, как и автор, я прищёл к выводу, что добавление к сентименту технических параметров приводит к дальнейшему улучшению результатов. Находит подтверждение следующее высказывание: "В настоящем исследовании представлены доказательства того, что фондовый рынок можно прогнозировать на основе новостных статей. Однако рекомендуется сочетать эти новостные статьи с техническим анализом."
* Как и у автора, у меня лучше всего сработала комбинация SVM + TextBlob + TA, однако, с использованием других гиперпараметров, чем у автора.
* В исследовании лучшим достигнутым показателем accuracy является 0.69 (а не 0.75, как утверждалось на прошлом собеседовании. Показатель с таким результатом был AUC-PR)
* Мой лучший показатель accuracy составил 0.669. При этом я использовал SVM + TextBlob + TA и свои гиперпараметры для SVM, которые я выявил с использованием GridSearch на своих данных.
* Отклонение от результатов автора связанно с тем, что по описанию предобработки дейтасетов мне не удалось точно воспроизвести дейтасет автора.
* Как и автор, я использовал только те строки новостного дейтасета, в которых был прописан заголовок стати и в которых речь идёт о финансах или о бизнесе.
* Я тоже добавил параметр TextBlob, вычислил SMA и объединил дейтасеты по дате. Также, я нормалтзовал все параметры с использование z-score.
* также, был подсчитан параметр movement, на котором и происходит бинарная классификация. Этот параметр описыват, вырос, остался прежним или упал индекс S&P 500 по отношению к цене закрытия в предыдущий день
* Автор утверждает, что изначально, до обработки, новостной дейтасет хранит в себе новости с 2013 года по начало 2020 года. Однако, анализ данных показал, что по факту дейтасет содержит новостные статьи с 01.01.2016 года по 02.04.2020 года.
* Также, дейтафрейм содержит не 2.7 млн. строк, а 2.688.878 млн. строк.
* Дейтасет с данными индекса S&P 500 содержит изначально данные на период времени между 31.12.2012 и 31.01.2020. Для своей работы я использовал только тот промежуток времени, в который эти два дейтасета пересекаются: 01.01.2016 - 31.01.2020.
* Автор говорит на странице 20: "Зависимые переменные имеют 589 записей, в которых направление движения фондового рынка пошло вниз, и 480 записей, в которых цена фондового рынка пошла вверх или осталась прежней."
* Таким образом, у него получается 589 + 480 = 1069 строк. Однако, на странице 19 автор говорит о 1096 записях. Здесь есть какая-то нестыковка или это опечатка.
* Мне не удалось воспроизвести такое количество строк. Предварительная обработка данных и объединение двух наборов данных дает только 1027 строк (569 рост или прежний показатель и 458 падение), которые имеют заполненные значения по всем признакам. Возможно, автор забыл выбросить субботы и воскресенья в наборе данных новостей. Новости печатаются каждый день, в то время как фондовый рынок открыт только с понедельника по пятницу. Таким образом, для параметров S&P500 нет данных за выходные дни.
* При объёдинении дейтасетов автоматически стераются те дни, за которые отсутствуют данные. Новостные данные существуют на все дни недели, с понедельника по воскресенье, в то время, как технические данные рынка S&P 500 существуют только для будних дней, понедельник по пятницу.
* у моего подхода есть слабое место. Новости по субботам и воскресеньям не учитываются. Если автор использует сентимент из новостей за выходные дни, то он не описал, как он обрабатывает недостающие данные по open, close, value и т.д. за эти дни. Одним из подходов может быть заполнение этих значений для каждой субботы и воскресенья теми же данными, что и для предыдущей пятницы.
* На данный момент я не буду следовать этому подходу. Таким образом, последние 10 дней для настроений и технических данных для понедельника будут ПН-ПТ из двух предыдущих недель.
* В силу игнорирования выходных дней, мои итоговое дейтасеты начинаются с 04.01.2016
* Общее количество строк в моём дейтасете 1027 (а у автора 1096 или 1069)
* на фоне описанных расхождений есть предположение, что автор либо использовал другую версию изначального дейтасета, либо он не точно и не полно описал свои действия. Как мы видим, некоторые погрешности у него есть.
* Т.к. мой дейтасет отличается от того дейтасета, который получил автор, я решил попробовать использовать гиперпараметры по умолчанию, гиперпараметры автора и гиперпараметры, полученные из своего поиска GridSearch на своих данных. Ипользование гиперпараметров автора или гиперпараметров по умолчанию привело к низким показателям accuracy.
* поиск оптимальных гиперпараметров для моих дейтасетов выявил следующие оптимальные показатели:
	* SVM + TextBlob: {'C': 1, 'gamma': 1, 'kernel': 'linear'} 
	* SVM + TextBlob + TA: {'C': 100, 'gamma': 1, 'kernel': 'linear'}
	* у автора было: {'C': 100, 'gamma': 0.001, 'kernel': 'rbf'}
* Accuracy по всем моим экспериментам (округлённый):
	* SVM + TextBlob with SVM with default hyperparameters: 0.587
	* SVM + TextBlob with SVM with own optimal hyperparameters: 0.578
	* SVM + TextBlob with hyperparameters from paper: 0.578
	* SVM + TextBlob + TA with SVM with default hyperparameters: 0.539
	* SVM + TextBlob + TA with SVM with own optimal hyperparameters: **0.667**
	* SVM + TextBlob + TA with hyperparameters from paper: 0.592



### 1. Преимущества

* автор провел тщательную предварительную обработку данных, несмотря на то, что в некоторых моментах его объяснения были неполными или неясными, что затрудняло точное воспроизведение его исследования
* автор экспериментировал с различными методами, а не только с одним.


### 2. Недостатки

* Исследователь решил отфильтровать текст статьи, поскольку его компьютер не смог выполнить ни один из методов анализа настроений на всем тексте статьи. Поэтому заголовок статьи рассматривается как отражение настроения новостной статьи. -> анализ настроения может быть более точным на всем тексте новости
* Как были выбраны данные и акции?    
* Прогнозирование ежедневного движения индекса S&P 500 удобно для торговли или инвестиций в ETF, основанные на S&P 500, но было бы неплохо реализовать прогнозирование для отдельных компаний в будущем.
* Поскольку прогноз акций на следующий день считается краткосрочным прогнозом, период должен быть установлен на 10 дней.
	* автор не пробовал другие периоды времени долгосрочный/среднесрочный/краткосрочный
* голосование большинством голосов (majority vote) было бы возможно не только на разных моделях, но и на разных периодах времени


### 3. Ошибки

* Анализ на основе новостей не всегда является хорошей идеей, особенно, если новости касаются инсайдерской информации компании из-за инсайдерской торговли.
* Часто, если новость вышла, уже слишком поздно " вскочить на тренд", нужно делать свой ход заранее.
* В целом, в некоторых моментах автор не мотивировал свои решения. Иногда он приводил некоторые цитаты, но в других случаях это было похоже на гадание.


### 4. Рекомендации
* попробовать больше методов для классификации
* попробовать использовать ensemble learning/majority vote, когда вы получаете результат от нескольких моделей. После этого вы можете выбрать предсказание, которое было сгенерировано большинством моделей.
* попытаться использовать больше данных
* попытаться вычислить больше параметров для TA
* было бы интересно учитывать не только сентимент новостей, но и другие параметры NLP
	* первая идея - искать важные ключевые слова, которые встречались в новостях в рассматриваемый период времени до того, как на рынке произошёл памп или дамп.
	* например, постоянное упоминание слова "война" может обрушить цены на акции, в то время как n-gramm "растущее потребление" может привести к росту графика






